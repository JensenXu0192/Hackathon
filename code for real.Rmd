---
title: "code for real"
author: "Yuxuan"
date: "16/11/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(dplyr)
account <- read.csv("ACCOUNT_DATASET_ST.csv")
philine <- read.csv("PHLINE_DATASET_ST.csv")
city <- read.csv("CITY_DATASET_ST.csv")
head(city)
head(acc_phi)
acc_phi <- inner_join(account, philine, by = "acc_num")
head(acc_phi)
dplyr::left_join(acc_phi,city,by="bill_city")->fulldata
#data
fulldata %>% mutate(ph_k_date = as.Date(fulldata$ph_k_date), st_date = as.Date(fulldata$st_date)) -> fulldata
#date
fulldata %>% mutate(ph_k_date = as.Date(fulldata$ph_k_date), st_date = as.Date(fulldata$st_date)) -> fulldata
head(fulldata)
levels(fulldata$data_plan_m8)

#missing value indicator, 1 for missing, 0 otherwise
fulldata %>% mutate(missing_phdate = ifelse(is.na(fulldata$ph_k_date) == 1, 1, 0)) -> fulldata
#data plan prices
fulldata %>% mutate(data_plan_m8 = as.factor(data_plan_m8)) -> fulldata

#data roam volum
levels(fulldata$data_plan_m8)
fulldata %>% mutate(data_volume = ifelse(fulldata$data_plan_m8 == "10GB($65)", 10, 15)) %>% mutate(data_volume = ifelse(fulldata$data_plan_m8 == "15GB($80)", 15, 25)) -> fulldata
fulldata %>% mutate(data_left = data_volume - mon_data) -> fulldata
#churn binary
fulldata %>% mutate(churn = factor(fulldata$churn)) -> fulldata
levels(fulldata$churn)
levels(fulldata$data_plan_m8)
head(fulldata)
#
fulldata$ph_k_date <- as.POSIXct(na.approx(fulldata$ph_k_date), origin = "2014-7-28")
```

```{r}
fulldata$ph_k_date<-time(fulldata$ph_k_date)
fulldata$cr_score<-as.factor(fulldata$cr_score)
fulldata$churn<-as.factor(fulldata$churn)
```


```{r}
#est, val, holdout groups
fulldata %>% filter(Sample == "Estimation")%>%select(-Sample) -> est.d
fulldata %>% filter(Sample == "Holdout")%>%select(-Sample) -> hold.d
fulldata %>% filter(Sample == "Validation")%>%select(-Sample) -> val.d

```

```{r}

#data munipulaiton

```


```{r}
as.factor(est.d$churn)->est.d$churn
levels(est.d$churn) 
fit.logistic <- glm(churn ~.,family = binomial,data=est.d)


fit.test <- glm(formula = churn ~ ., family = "binomial", data = est.d)


````
