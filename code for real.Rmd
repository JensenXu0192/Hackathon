---
title: "code for real"
author: "Yuxuan"
date: "16/11/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(dplyr)
account <- read.csv("ACCOUNT_DATASET_ST.csv")
philine <- read.csv("PHLINE_DATASET_ST.csv")
city <- read.csv("CITY_DATASET_ST.csv")
head(city)
head(acc_phi)
acc_phi <- inner_join(account, philine, by = "acc_num")
head(acc_phi)
dplyr::left_join(acc_phi,city,by="bill_city")->fulldata
#data
fulldata %>% mutate(ph_k_date = as.Date(fulldata$ph_k_date), st_date = as.Date(fulldata$st_date)) -> fulldata
#date
fulldata %>% mutate(ph_k_date = as.Date(fulldata$ph_k_date), st_date = as.Date(fulldata$st_date)) -> fulldata
#missing value indicator, 1 for missing, 0 otherwise
fulldata %>% mutate(missing_phdate = ifelse(is.na(fulldata$ph_k_date) == 1, 1, 0)) -> fulldata
#data plan prices
fulldata %>% mutate(data_plan_m8 = as.factor(data_plan_m8)) -> fulldata

#data roam volum
levels(fulldata$data_plan_m8)
fulldata %>% mutate(data_volume = ifelse(fulldata$data_plan_m8 == "10GB($65)", 10, 15)) %>% mutate(data_volume = ifelse(fulldata$data_plan_m8 == "15GB($80)", 15, 25)) -> fulldata
fulldata %>% mutate(data_left = data_volume - mon_data) -> fulldata
#churn binary
fulldata %>% mutate(churn = factor(fulldata$churn)) -> fulldata
levels(fulldata$churn)
levels(fulldata$data_plan_m8)
head(fulldata)
```



```{r}
#est, val, holdout groups
fulldata %>% filter(Sample == "Estimation") -> est.d
fulldata %>% filter(Sample == "Holdout") -> hold.d
fulldata %>% filter(Sample == "Validation") -> val.d
````

```{r}
typeof(est.d$churn)
levels(est.d$churn)
fit.test <- glm(formula = churn ~ ., family = "binomial", data = est.d)

````
